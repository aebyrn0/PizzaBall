@using PizzaBall.Models.GameClasses
@model GameInstance

@{
    ViewBag.Title = "PlayGame";
}

<h3>@Model.NumberOfPlayers Players</h3>

<div class="alert-warning">Player @(Model.CurrentPlayerTurn)'s turn</div>
<div class="alert-info">Click a square to play</div>

@using (Html.BeginForm("PlayerAction", "Home", FormMethod.Post, new { id = "frmPlayerAction" }))
{ 
    <table class="table-bordered table-striped table">
    @foreach (int i in Model.GameGrid.BoardRows.Keys)
    {
        <tr>
            @foreach (LandSlot b in Model.GameGrid.BoardRows[i])
            {
                <td align="center">
                    @if (b.Occupied())
                    {
                        @Html.Partial("_DisplayPuzzleCard", b.CardInfo)
                    }
                    else
                    {
                        <div class="squareClicked" data-x="@(i)" data-y="@(b.Yvalue)">Click a Card, then click here</div>
                    }
                </td>
            }
        </tr>
    }
    </table>

    <h3>Player @(Model.CurrentPlayerTurn)'s Cards:</h3>
    <table class="table-bordered table-striped table">
        <tr>
            @foreach (LandCard c in Model.Players[Model.CurrentPlayerTurn].Hand)
            {
                <td>
                    @Html.Partial("_DisplayPuzzleCard", c)
                </td>
            }
        </tr>
    </table>

    @*foreach (var player in Model.Players)
    {
    <h3>Player @(player.Key)'s Cards:</h3>
    <table class="table-bordered table-striped table">
        <tr>
            @foreach (PuzzleCard c in player.Value.Hand)
            {
                <td>
                    @Html.Partial("_DisplayPuzzleCard", c)
                </td>
            }
        </tr>
    </table>
    }*@

    @*<h3>Remaining Deck:</h3>
    <table class="table-bordered table-striped table">
        @foreach (PuzzleCard c in Model.PuzzleDeck.Deck)
        {
            <tr>
                <td>
                    @Html.Partial("_DisplayPuzzleCard", c)
                </td>
            </tr>
        }
    </table>*@

    <input type="hidden" id="gridXvalue" name="gridXvalue" value="" />
    <input type="hidden" id="gridYvalue" name="gridYvalue" value="" />
    <input type="hidden" id="playCardId" name="playCardId" value="" />
}

@section scripts
{
<script type="text/javascript">
    $(document).ready(function () {

        $(".playerCard").click(function () {
            $(this).addClass('alert-danger');

            var cardId = $(this).data('cardid');
            $('#playCardId').val(cardId);
        });

        $(".squareClicked").click(function () {

            if (!$('#playCardId').val()) {
                alert('Please select a card to play.')
                return;
            }

            var x_value = $(this).data('x');
            var y_value = $(this).data('y');

            $('#gridXvalue').val(x_value);
            $('#gridYvalue').val(y_value);

            $("#frmPlayerAction").submit();
        });
    });
</script>
}
